<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Thêm phiếu nhập mới</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:ital,opsz,wght@0,6..12,400;0,6..12,600;0,6..12,700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" rel="stylesheet">
  <link href="../../assets/css/admin/dashboard.css" rel="stylesheet">
      <script src="../../assets/js/admin.js" defer></script>
  <style>
:root {
  --primary: #6366f1;
  --primary-dark: #4f46e5;
  --primary-light: #818cf8;
  --danger: #ef4444;
  --success: #10b981;
  --gray-100: #f3f4f6;
  --gray-200: #e5e7eb;
  --gray-600: #4b5563;
  --gray-800: #1f2937;
  --shadow: 0 10px 25px -5px rgba(99, 102, 241, 0.15);
  --radius: 12px;
}

.form-container {
  background: white;
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 32px;
  border: 1px solid var(--gray-200);
  max-width: 100%;
  margin: 0 auto;
}

.form-row {
  display: flex;
  gap: 20px;
  margin-bottom: 20px;
  flex-wrap: wrap;
}

.form-row .form-group { flex: 1; min-width: 280px; }

.form-group label {
  display: block;
  font-weight: 600;
  color: var(--gray-800);
  margin-bottom: 8px;
  font-size: 14.5px;
}

.form-group input,
.form-group select {
  width: 100%;
  padding: 13px 16px;
  border: 1.8px solid var(--gray-200);
  border-radius: var(--radius);
  font-size: 15px;
  transition: all 0.25s ease;
  background: white;
}

.form-group input:focus,
.form-group select:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.15);
}

/* Dropdown tìm kiếm */
.select-search {
  position: relative;
}

.select-search input {
  padding-right: 45px;
  cursor: pointer;
}

.select-search::after {
  content: '\f078';
  font-family: 'Font Awesome 6 Free';
  font-weight: 900;
  position: absolute;
  right: 14px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--primary);
  pointer-events: none;
  font-size: 14px;
}

/* ================================
   DROPDOWN FIX – KHÔNG ANIMATION
   ================================ */
.select-options {
  position: fixed !important;
  max-height: 280px;
  overflow-y: auto;

  background: white;
  border-radius: var(--radius);
  border: 1.8px solid var(--primary);
  z-index: 3000;
  box-shadow: var(--shadow);

  /* Tắt toàn bộ animation */
  opacity: 1 !important;
  visibility: visible !important;
  transform: none !important;
  transition: none !important;

  display: none; /* Ẩn bằng display */
}

.select-options.show {
  display: block; /* Hiện ngay lập tức */
}

.select-option {
  padding: 14px 16px;
  cursor: pointer;
  border-bottom: 1px solid var(--gray-100);
}

.select-option:hover {
  background: var(--primary-light);
  color: white;
}

.select-option:last-child { border-bottom: none; }

.select-option strong { color: var(--primary); font-weight: 700; }
.select-option small { display: block; margin-top: 4px; opacity: 0.9; font-size: 13px; }

/* Bảng nhập hàng */
.import-items-table {
  width: 100%;
  border-collapse: collapse;
  margin: 25px 0;
  border-radius: var(--radius);
  overflow: hidden;
  box-shadow: 0 4px 15px rgba(0,0,0,0.08);
}

.import-items-table th {
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  color: white;
  padding: 16px 14px;
  text-align: left;
  font-weight: 600;
  font-size: 15px;
}

.import-items-table td {
  padding: 14px;
  background: white;
  border-bottom: 1px solid var(--gray-100);
}

.import-items-table tbody tr:hover { background: #f8faff; }

.import-items-table input {
  width: 100%;
  padding: 10px 12px;
  border: 1.5px solid var(--gray-200);
  border-radius: 8px;
  font-size: 14.5px;
}

.line-total {
  font-weight: 700;
  color: var(--primary-dark);
  font-size: 16px;
}

.total-row {
  background: linear-gradient(90deg, #f8faff, #eef2ff) !important;
  font-size: 19px !important;
}

.total-row td {
  padding: 20px 14px !important;
  font-weight: 700;
}

#grandTotal {
  color: var(--primary-dark) !important;
  font-size: 22px !important;
}

.delete-row {
  background: var(--danger);
  color: white;
  border: none;
  padding: 10px 12px;
  border-radius: 8px;
  cursor: pointer;
}

.delete-row:hover {
  background: #dc2626;
  transform: scale(1.1);
}

.btn {
  padding: 13px 28px;
  border: none;
  border-radius: var(--radius);
  font-weight: 600;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 10px;
  transition: all 0.3s ease;
  font-size: 15px;
}

.btn.add-row {
  background: var(--success);
  color: white;
  box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
}

.btn.add-row:hover { background: #059669; transform: translateY(-2px); }

.btn.save {
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  color: white;
  box-shadow: 0 6px 20px rgba(99, 102, 241, 0.35);
}

.btn.save:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 25px rgba(99, 102, 241, 0.45);
}

.btn.cancel {
  background: var(--gray-600);
  color: white;
  text-decoration: none;
}

.btn.cancel:hover { background: var(--gray-800); }

.form-footer {
  margin-top: 40px;
  padding-top: 25px;
  border-top: 2px dashed var(--gray-200);
  display: flex;
  justify-content: flex-end;
  gap: 15px;
  flex-wrap: wrap;
}

h3 {
  color: var(--primary-dark);
  font-size: 20px;
  margin: 30px 0 10px;
  font-weight: 700;
}

.selected-product {
  color: var(--primary-dark) !important;
  font-weight: 600;
  font-size: 14px;
  margin-top: 6px;
  display: block;
}


  </style>
</head>
<body>

<aside class="side-bar">
        <div class="logo">
            <h2><a href="/admin/dashboard.html">LEGO STORE </a></h2>
        </div>
        <nav class="menu">
           <ul class="system">
                <li > <a href="/admin/dashboard.html"><i class="fa-solid fa-house"></i>Tổng quan</a></li>
                <li><a href="/admin/messages.html"><i class="fa-solid fa-envelope"></i>Tin nhắn <span class="message">2</span></a></li>
                <li><a href="/admin/products/products.html" ><i class="fa-solid fa-box"></i>Sản phẩm</a></li>
                <li><a href="/admin/product-types/list.html" ><i class="fa-solid fa-tags"></i>Danh mục</a></li>
                <li><a href="/admin/orders/orders.html"><i class="fa-solid fa-receipt"></i>Đơn hàng</a></li>
                <li><a href="/admin/imports/imports.html" class="active"><i class="fa-solid fa-truck"></i>Nhập hàng</a></li>
                <li><a href="/admin/imports/inventorys.html"><i class="fa-solid fa-warehouse"></i>Tồn kho</a></li>
                <li><a href="/admin/imports/pricing.html"><i class="fa-solid fa-coins"></i>Giá bán</a></li>
                <li><a href="/admin/customers/customers.html"><i class="fa-solid fa-users"></i>Khách hàng</a></li>
            </ul>

            <ul class="support">
                <li><a href="/admin/login.html"><i class="fa-solid fa-right-from-bracket"></i>Đăng xuất</a></li>
            </ul>
        </nav>
    </aside>

<div class="main-content">
  <header class="admin-header">
    <h1>Thêm phiếu nhập mới</h1>
    <div class="admin-info">
      <span class="info">
        <i class="fa-solid fa-bell"><span class="noti">3</span></i>
        <img src="/assets/images/avt.png" alt="Admin" />
        <p class="nametag">Việt Hoàng</p>
      </span>
    </div>
  </header>

  <section class="content add-import-page">
    <div class="add-import-layout">
      <div class="form-container">
        <form class="import-form">
          <div class="form-row">
            <div class="form-group">
              <label for="supplier">Nhà cung cấp</label>
              <input type="text" id="supplier" placeholder="VD: LEGO Việt Nam, ToyWorld..." required>
            </div>
            <div class="form-group">
              <label for="date">Ngày nhập</label>
              <input type="date" id="date" required>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="status">Trạng thái</label>
              <select id="status">
                <option value="completed">Hoàn thành</option>
                <option value="pending" selected>Đang chờ</option>
                <option value="cancelled">Hủy</option>
              </select>
            </div>
            <div class="form-group">
              <label for="note">Ghi chú</label>
              <input type="text" id="note" placeholder="Ghi chú (không bắt buộc)">
            </div>
          </div>

          <h3>Sản phẩm nhập</h3>
          <table class="import-items-table">
            <thead>
              <tr>
                <th>Sản phẩm</th>
                <th>Số lượng</th>
                <th>Đơn giá nhập</th>
                <th>Thành tiền</th>
                <th>Xóa</th>
              </tr>
            </thead>
            <tbody id="importItemsBody"></tbody>
            <tfoot>
              <tr class="total-row">
                <td colspan="3" style="text-align:right;">Tổng cộng:</td>
                <td id="grandTotal">0₫</td>
                <td></td>
              </tr>
            </tfoot>
          </table>

          <button type="button" class="btn add-row" id="addRowBtn">
            Thêm sản phẩm
          </button>

          <div class="form-footer">
            <button type="submit" class="btn save">
              Lưu phiếu nhập
            </button>
            <a href="imports.html" class="btn cancel">
              Hủy bỏ
            </a>
          </div>
        </form>
      </div>
    </div>
  </section>
</div>

<script>
// Danh sách sản phẩm mẫu
const products = [
  { id: 1, sku: "75257", name: "LEGO Star Wars Tàu Millennium Falcon 75257", price: 2000000 },
  { id: 2, sku: "41704", name: "LEGO Friends Thành phố Heartlake 41704", price: 1500000 },
  { id: 3, sku: "71738", name: "LEGO Ninjago Zane's Titan Mech Battle", price: 1200000 },
  { id: 4, sku: "10274", name: "LEGO Creator Expert Ghostbusters ECTO-1", price: 4800000 },
  { id: 5, sku: "42115", name: "LEGO Technic Lamborghini Sián FKP 37", price: 8500000 },
  { id: 6, sku: "60337", name: "LEGO City Express Passenger Train", price: 3200000 },
  { id: 7, sku: "76405", name: "LEGO Harry Potter Hogwarts Express", price: 2100000 },
  { id: 8, sku: "71395", name: "LEGO Super Mario 64 Question Mark Block", price: 4200000 },
];

document.getElementById('addRowBtn').addEventListener('click', addNewRow);
document.addEventListener('DOMContentLoaded', () => addNewRow());

function addNewRow() {
  const tbody = document.getElementById('importItemsBody');
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td style="position:relative;">
      <div class="select-search">
        <input type="text" class="product-search" placeholder="Tìm tên hoặc mã sản phẩm..." autocomplete="off">
        <div class="select-options"></div>
      </div>
      <input type="hidden" class="product-id">
      <small class="selected-product" style="display:none;"></small>
    </td>
    <td><input type="number" class="quantity" min="1" value="1" style="width:90px;"></td>
    <td><input type="number" class="unit-price" min="0" value="0" style="width:130px;"></td>
    <td class="line-total">0₫</td>
    <td><button type="button" class="delete-row" title="Xóa dòng"><i class="fa-solid fa-trash"></i></button></td>
  `;
  tbody.appendChild(tr);

  const searchInput   = tr.querySelector('.product-search');
  const optionsDiv    = tr.querySelector('.select-options');
  const hiddenId      = tr.querySelector('.product-id');
  const selectedName  = tr.querySelector('.selected-product');
  const unitPrice     = tr.querySelector('.unit-price');
  const quantity      = tr.querySelector('.quantity');
  const lineTotal     = tr.querySelector('.line-total');

  searchInput.addEventListener('focus', showAllOptions);
  searchInput.addEventListener('input', () => filterOptions(searchInput.value));

  optionsDiv.addEventListener('mousedown', (e) => {
    e.preventDefault();
    const option = e.target.closest('.select-option');
    if (!option) return;
    const product = products.find(p => p.id == option.dataset.id);
    searchInput.value = product.sku;
    hiddenId.value = product.id;
    selectedName.textContent = product.name;
    selectedName.style.display = 'block';
    unitPrice.value = product.price;
    optionsDiv.classList.remove('show');
    calculateLineTotal();
  });

  quantity.addEventListener('input', calculateLineTotal);
  unitPrice.addEventListener('input', calculateLineTotal);

  function calculateLineTotal() {
    const qty = parseInt(quantity.value) || 0;
    const price = parseFloat(unitPrice.value) || 0;
    lineTotal.textContent = (qty * price).toLocaleString('vi-VN') + '₫';
    calculateGrandTotal();
  }

  tr.querySelector('.delete-row').addEventListener('click', () => {
    tr.remove();
    calculateGrandTotal();
  });

  function showAllOptions() {
    optionsDiv.innerHTML = products.map(p => `
      <div class="select-option" data-id="${p.id}">
        <div><strong>${p.sku}</strong> - ${p.name}</div>
        <small>Giá nhập: ${p.price.toLocaleString('vi-VN')}₫</small>
      </div>
    `).join('');
    optionsDiv.classList.add('show');
  }

  function filterOptions(term) {
    const filtered = products.filter(p =>
      p.sku.toLowerCase().includes(term.toLowerCase()) ||
      p.name.toLowerCase().includes(term.toLowerCase())
    );
    optionsDiv.innerHTML = filtered.length
      ? filtered.map(p => `
          <div class="select-option" data-id="${p.id}">
            <div><strong>${p.sku}</strong> - ${p.name}</div>
            <small>Giá nhập: ${p.price.toLocaleString('vi-VN')}₫</small>
          </div>
        `).join('')
      : '<div style="padding:16px; color:#999; text-align:center;">Không tìm thấy sản phẩm</div>';
    optionsDiv.classList.add('show');
  }
searchInput.addEventListener('focus', positionDropdown);
searchInput.addEventListener('input', positionDropdown);

function positionDropdown() {
    const rect = searchInput.getBoundingClientRect();
    optionsDiv.style.left = rect.left + "px";
    optionsDiv.style.top = (rect.bottom + 4) + "px";  
    optionsDiv.style.width = rect.width + "px";
}

}

function calculateGrandTotal() {
  let total = 0;
  document.querySelectorAll('.line-total').forEach(el => {
    total += parseInt(el.textContent.replace(/[^0-9]/g, '')) || 0;
  });
  document.getElementById('grandTotal').textContent = total.toLocaleString('vi-VN') + '₫';
}

document.addEventListener('click', (e) => {
  if (!e.target.closest('.select-search')) {
    document.querySelectorAll('.select-options').forEach(opt => opt.classList.remove('show'));
  }
});
</script>

</body>
</html>