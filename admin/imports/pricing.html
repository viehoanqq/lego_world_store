<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:ital,opsz,wght@0,6..12,200..1000;1,6..12,200..1000&display=swap" rel="stylesheet">

  <link href="../../assets/css/admin/dashboard.css" rel="stylesheet">
  <link href="../../assets/css/admin/import.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" rel="stylesheet">
  <script src="../../assets/js/admin.js" defer></script> 

  <title>Quản lý giá bán</title>

  <style>
    :root { --primary: #6366f1; }

    body {font-family:'Nunito Sans',sans-serif;margin:0;padding:0;background:#f5f5f5;}
    .main-content {padding:20px;}
    h1 {margin-bottom:15px;}

    .report-buttons {display:flex;flex-wrap:wrap;gap:10px;margin-bottom:20px;}
    .report-buttons button {
      padding:12px 20px;border-radius:8px;cursor:pointer;
      border:1px solid #ccc;background:#f3f4f6;font-size:1rem;font-weight:600;
      transition: all 0.2s;
    }
    .report-buttons button:hover {background:#e5e7eb;}
    .report-buttons button.active {background:var(--primary);color:#fff;border-color:var(--primary);}

    .filter-group {
      display:flex;flex-wrap:wrap;gap:12px;margin-bottom:20px;align-items:center;
    }
    .filter-group input,.filter-group select,.filter-group button {
      padding:10px;border:1px solid #ccc;border-radius:6px;font-size:.95rem;
    }
    .filter-group input[type="text"] {min-width:250px;}
    .filter-group select {min-width:180px;}
    .filter-group button {
      background:var(--primary);color:#fff;border:none;cursor:pointer;
      min-width:100px;font-weight:600;
    }
    .filter-group button:hover {background:#4f46e5;}

    table {width:100%;border-collapse:collapse;margin-top:20px;background:#fff;box-shadow:0 1px 3px rgba(0,0,0,.1);}
    th,td {border:1px solid #ddd;padding:10px;text-align:center;}
    th {background:var(--primary);color:#fff;font-weight:600;}

    .profit-input {width:70px;padding:6px;border:1px solid #ccc;border-radius:4px;text-align:center;}
    .profit-input:focus {border-color:var(--primary);outline:none;}

    .price {font-weight:600;color:#1f2937;}
    .profit {color:#059669;font-weight:600;}
    .cost {color:#dc2626;}

    .no-data {text-align:center;padding:30px;color:#666;font-style:italic;}

    @media(max-width:768px){
      .filter-group{flex-direction:column;align-items:stretch;}
      .filter-group input,.filter-group select,.filter-group button{width:100%;}
    }
  </style>
</head>

<body>
  <aside class="side-bar">
    <div class="logo"><h2><a href="/admin/dashboard.html">LEGO STORE</a></h2></div>
    <nav class="menu">
      <ul class="system">
        <li><a href="/admin/dashboard.html"><i class="fa-solid fa-house"></i>Tổng quan</a></li>
        <li><a href="/admin/messages.html"><i class="fa-solid fa-envelope"></i>Tin nhắn <span class="message">2</span></a></li>
        <li><a href="/admin/products/products.html"><i class="fa-solid fa-box"></i>Sản phẩm</a></li>
        <li><a href="/admin/product-types/list.html"><i class="fa-solid fa-tags"></i>Danh mục</a></li>
        <li><a href="/admin/orders/orders.html"><i class="fa-solid fa-receipt"></i>Đơn hàng</a></li>
        <li><a href="/admin/imports/imports.html"><i class="fa-solid fa-truck"></i>Nhập hàng</a></li>
        <li><a href="/admin/imports/inventorys.html"><i class="fa-solid fa-warehouse"></i>Tồn kho</a></li>
        <li><a href="/admin/imports/pricing.html" class="active"><i class="fa-solid fa-coins"></i>Giá bán</a></li>
        <li><a href="/admin/customers/customers.html"><i class="fa-solid fa-users"></i>Khách hàng</a></li>
      </ul>
      <ul class="support">
        <li><a href="/admin/login.html"><i class="fa-solid fa-right-from-bracket"></i>Đăng xuất</a></li>
      </ul>
    </nav>
  </aside>

  <div class="main-content">
    <header class="admin-header">
      <h1>Quản lý tồn kho</h1>
      <div class="admin-info">
        <span class="search-bar">
          <button><i class="fa-solid fa-magnifying-glass"></i></button>
          <input placeholder="Tìm kiếm...">
        </span>
        <span class="info">
          <i class="fa-solid fa-bell"><span class="noti">3</span></i>
          <img src="/assets/images/avt.png" alt="Ảnh admin" />
          <p class="nametag">Việt Hoàng</p>
          <i class="fa-solid fa-chevron-down"></i>
        </span>
      </div>
    </header> <!-- ĐÓNG HEADER TẠI ĐÂY -->
    <section class="content">
      <!-- 3 chế độ -->
      <div class="report-buttons">
        <button id="btnByCategory" class="active">Theo danh mục</button>
        <button id="btnByProduct">Theo sản phẩm</button>
        <button id="btnLookup">Tra cứu giá & lợi nhuận</button>
      </div>

      <!-- Bộ lọc (giao diện) -->
      <div class="filter-group">
        <input type="text" id="searchInput" placeholder="Tìm kiếm sản phẩm...">
        <select id="categoryFilter">
          <option value="">Tất cả danh mục</option>
        </select>
        <button id="btnFilter"><i class="fa-solid fa-filter"></i> Lọc</button>
      </div>

      <!-- Bảng -->
      <div class="table-container">
        <table id="pricingTable">
          <thead id="tableHeader">
            <tr>
              <th>STT</th>
              <th id="col1">Danh mục</th>
              <th id="col2">% Lợi nhuận</th>
              <th id="col3" style="display:none;">Sản phẩm</th>
              <th id="col4" style="display:none;">Giá vốn</th>
              <th id="col5" style="display:none;">% LN</th>
              <th id="col6" style="display:none;">Giá bán</th>
              <th id="col7" style="display:none;">Lợi nhuận</th>
            </tr>
          </thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>
    </section>
  </div>
<script>
  // DỮ LIỆU SẢN PHẨM
  const products = [
    { id: "#75257", name: "LEGO Star Wars Tàu Millennium Falcon 75257", category: "Tàu vũ trụ", cost: 2000000, profitPercent: 25, stock: 12 },
    { id: "#42143", name: "LEGO Technic Xe Ferrari 42143", category: "Xe ô tô mô hình", cost: 2500000, profitPercent: 28, stock: 10 },
    { id: "#41704", name: "LEGO Friends Thành phố Heartlake 41704", category: "Thành phố hiện đại", cost: 1400000, profitPercent: 28.57, stock: 8 },
    { id: "#71753", name: "LEGO Ninjago Rồng Huyền Thoại 71753", category: "Động vật hoang dã", cost: 700000, profitPercent: 28.57, stock: 16 },
    { id: "#31126", name: "LEGO Creator Xe Máy Bay 31126", category: "Xe ô tô mô hình", cost: 580000, profitPercent: 29.31, stock: 9 },
    { id: "#10933", name: "LEGO Duplo Thị Trấn 10933", category: "Thành phố hiện đại", cost: 850000, profitPercent: 29.41, stock: 3 }
  ];

  function calculatePrice(cost, percent) {
    const price = cost * (1 + percent / 100);
    const profit = price - cost;
    return { price: Math.round(price), profit: Math.round(profit) };
  }

  // Danh mục
  const categories = [...new Set(products.map(p => p.category))];
  const categoryFilter = document.getElementById('categoryFilter');
  categories.forEach(cat => {
    const opt = document.createElement('option');
    opt.value = cat; opt.textContent = cat;
    categoryFilter.appendChild(opt);
  });

  let mode = 'category';
  const tableBody = document.getElementById('tableBody');

  function renderTable() {
    tableBody.innerHTML = '';
    const col1 = document.getElementById('col1');
    const col2 = document.getElementById('col2');
    const col3 = document.getElementById('col3');
    const col4 = document.getElementById('col4');
    const col5 = document.getElementById('col5');
    const col6 = document.getElementById('col6');
    const col7 = document.getElementById('col7');

    // Ẩn tất cả trước
    [col1, col2, col3, col4, col5, col6, col7].forEach(c => c.style.display = 'none');

    if (mode === 'category') {

      [col1, col2, col3].forEach(c => c.style.display = '');

      const catProfits = {};
      products.forEach(p => {
        if (!catProfits[p.category]) catProfits[p.category] = { total: 0, count: 0 };
        catProfits[p.category].total += p.profitPercent;
        catProfits[p.category].count++;
      });

      let i = 1;
      for (const [cat, data] of Object.entries(catProfits)) {
        const avg = (data.total / data.count).toFixed(2);
        tableBody.innerHTML += `
          <tr>
            <td>${i++}</td>
            <td><strong>${cat}</strong></td>
            <td>
              <input type="number" class="profit-input" value="${avg}" min="0" step="0.1" style="width:70px;">
              <span>%</span>
            </td>
          </tr>`;
      }
    }
    else if (mode === 'product') {
      col3.innerText = 'Sản phẩm';
      col4.innerText = 'Giá vốn';
      col5.innerText = '% Lợi nhuận';
      col6.innerText = 'Giá bán';
      [col3, col4, col5, col6].forEach(c => c.style.display = '');

      products.forEach((p, i) => {
        const { price } = calculatePrice(p.cost, p.profitPercent);
        tableBody.innerHTML += `
          <tr>
            <td>${i+1}</td>
            <td>${p.name}</td>
            <td class="cost">${p.cost.toLocaleString()}₫</td>
            <td>
              <input type="number" class="profit-input" value="${p.profitPercent}" min="0" step="0.1" style="width:70px;">
              <span>%</span>
            </td>
            <td class="price">${price.toLocaleString()}₫</td>
          </tr>`;
      });
    }
    else if (mode === 'lookup') {
      col3.innerText = 'Sản phẩm';
      col4.innerText = 'Giá vốn';
      col5.innerText = '% LN';
      col6.innerText = 'Giá bán';
      col7.innerText = 'Lợi nhuận';
      [col3, col4, col5, col6, col7].forEach(c => c.style.display = '');

      products.forEach((p, i) => {
        const { price, profit } = calculatePrice(p.cost, p.profitPercent);
        tableBody.innerHTML += `
          <tr>
            <td>${i+1}</td>
            <td>${p.name}</td>
            <td class="cost">${p.cost.toLocaleString()}₫</td>
            <td>${p.profitPercent}%</td>
            <td class="price">${price.toLocaleString()}₫</td>
            <td class="profit">${profit.toLocaleString()}₫</td>
          </tr>`;
      });
    }

    if (!tableBody.innerHTML) {
      tableBody.innerHTML = `<tr><td colspan="8" class="no-data">Không có dữ liệu.</td></tr>`;
    }
  }

  function setActiveMode(newMode, btn) {
    mode = newMode;
    document.querySelectorAll('.report-buttons button').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    renderTable();
  }

  // Sự kiện nút
  document.getElementById('btnByCategory').onclick = () => setActiveMode('category', document.getElementById('btnByCategory'));
  document.getElementById('btnByProduct').onclick = () => setActiveMode('product', document.getElementById('btnByProduct'));
  document.getElementById('btnLookup').onclick = () => setActiveMode('lookup', document.getElementById('btnLookup'));

  document.getElementById('btnFilter').onclick = () => {
    alert('Chức năng lọc sẽ được triển khai sau!');
  };

  // Cập nhật giá khi thay đổi % LN
  tableBody.addEventListener('input', e => {
    if (!e.target.classList.contains('profit-input')) return;
    const row = e.target.closest('tr');
    const percent = parseFloat(e.target.value) || 0;
    const cells = row.cells;

    if (mode === 'product') {
      const cost = products[row.rowIndex - 1].cost;
      const { price } = calculatePrice(cost, percent);
      cells[4].textContent = price.toLocaleString() + '₫';
    }
  });

  // Khởi tạo
  renderTable();
</script>
</body>
</html>